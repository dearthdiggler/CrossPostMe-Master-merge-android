# Health & Readiness Probes

This document explains the two endpoints implemented for health and readiness checks and how to configure Render (or other platforms) and CI to use them.

Endpoints

- `GET /api/ready` — Simple readiness probe suitable for platform checks.
  - Returns HTTP 200 with body `ready` when the application can reach the database.
  - Returns HTTP 503 when the DB is unreachable.
  - Use this path as your platform readiness/liveness probe (very low overhead).

- `GET /api/health` — JSON diagnostic endpoint for manual checks and monitoring.
  - Returns JSON with fields: `status` (`ok` or `unhealthy`), `timestamp`, and `db_connected` (bool).
  - When `HEALTH_DEBUG=true` is set in the environment the endpoint will include additional fields (`openssl` and `certifi_where`) for debugging TLS issues.

Recommended Render readiness probe settings

- Path: `/api/ready`
- Initial delay (start timeout): 10–30 seconds (if you have slow cold-starts use 30s)
- Interval: 10s
- Timeout: 5s
- Healthy threshold: 1
- Unhealthy threshold: 3

Environment variables to set in Render

- `MONGO_URL` — MongoDB Atlas connection string (mongodb+srv://...)
- `DB_NAME` — the name of your DB
- `ENV` — `production` (or `development` for local testing)
- Optional tuning:
  - `MONGO_STARTUP_MAX_RETRIES` (default 5)
  - `MONGO_STARTUP_RETRY_DELAY_SECONDS` (default 3)
  - `MONGO_SERVER_SELECTION_TIMEOUT_MS` (default 15000)
  - `HEALTH_DEBUG=true` (only enable while actively debugging; exposes internal cert path)

Post-deploy check (manual)

1. After deployment run:
   - `curl -i https://<your-backend>/api/ready` — should return HTTP 200
   - `curl -i https://<your-backend>/api/health` — returns JSON diagnostics

Security notes

- Do not enable `HEALTH_DEBUG` in production unless you need to debug TLS issues — it exposes internal cert path information.
- Keep `MONGO_URL` and other secrets stored in the platform's secret store (Render environment variables) — do not commit credentials.

Troubleshooting

- If `/api/ready` returns 503 but the cluster is reachable from your workstation:
  1. Clear build cache on Render and redeploy (ensures certifi/dnspython and updated pymongo/motor installed).
  2. Temporarily set Atlas IP access list to `0.0.0.0/0` to rule out IP allowlisting issues.
  3. Check application logs for SSL/TLS handshake errors and paste the last ~120 lines if you need assistance.

---

Generated by automation to document health endpoints and readiness probe configuration.
